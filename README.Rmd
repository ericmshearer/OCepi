---
output: github_document
---

```{r setup, echo = FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(
  comment = "#>",
  fig.path = "man/figures/README-"
  )
```

<!-- badges: start -->

[![R-CMD-check](https://github.com/ericmshearer/OCepi/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/ericmshearer/OCepi/actions/workflows/R-CMD-check.yaml) [![lifecycle](https://img.shields.io/badge/lifecycle-experimental-brightgreen.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental) [![Codecov test coverage](https://codecov.io/gh/ericmshearer/OCepi/branch/main/graph/badge.svg)](https://app.codecov.io/gh/ericmshearer/OCepi?branch=main)

<!-- badges: end -->

# OCepi <img src="man/figures/hex_sticker.png" align="right" width="180"/>

{OCepi} aims to provide a standardized approach to the mundane data wrangling tasks for public health epidemiologists. The functions included in this package can be broadly applied but were made specifically for epidemiologists at county and State agencies. This package addresses the following priorities:

-   standardization of recoding demographic data, specifically: ethnicity/race, gender, sexual orientation, and age groups
-   elevated branding for ggplots with tidy labels and aesthetics
-   simple methods to suppress/redact information prior to public reporting
-   methods to group cases/episode into MMWR disease weeks and years

For full documentation, see vignette/OCepi.md

## Installation

For the latest development version:

```{r install-dev, eval=FALSE}
# install.packages("devtools")
devtools::install_github("ericmshearer/OCepi")
```

## Example Use Cases

### Recoding + Plot

Here we have simulated outbreak data that needs cleaning prior to reporting/summarizing:

```{r read-load, echo=FALSE, warning=FALSE, message=FALSE}
library(here)
library(OCepi)
library(dplyr)
library(readr)
library(ggplot2)
linelist <- read_csv(here("data","linelist.csv"), na = "")
```

```{r glance, echo=FALSE}
head(linelist)
```

Applying the core functions:

```{r demographics}
linelist <- linelist %>%
  mutate(
    Gender = recode_gender(Gender),
    race_ethnicity = recode_race(Ethnicity, Race, abbr_names = FALSE),
    age_group = age_groups(Age, type = "school"),
    `Sexual Orientation` = recode_orientation(`Sexual Orientation`)
  )
```

```{r print, echo=FALSE}
count(linelist, Gender)
count(linelist, race_ethnicity)
count(linelist, age_group)
count(linelist, `Sexual Orientation`)
```

Next we'll make a nice plot for a slide deck/report. Functions `add_percent` will be used to create a percentage variable, and `n_percent` for making plot labels. We can control the order of n and percent in the label by using argument `reverse`.

```{r plot, fig.align='center', fig.width=10, fig.height=7}

linelist %>%
  count(age_group) %>%
  mutate(
    percent = add_percent(n),
    label = n_percent(formatC(n, big.mark = ","), percent, reverse = TRUE)
  ) %>%
  ggplot(aes(x = age_group, y = percent, label = label)) +
  geom_col(fill = "#283747") +
  scale_y_continuous(expand = c(0,0), limits = c(0,60)) +
  theme_apollo(direction = "vertical") +
  labs(
    title = "Age Distribution of Disease X, Your LHJ, Year",
    subtitle = "Unit/Program Name",
    x = "Age Group (Years)",
    y = "Percentage (%)"
  ) +
  apollo_label(direction = "vertical")

```

## Contact

Simplest ways to contact me:

-   Questions/Feedback: [ericshearer\@me.com](mailto:ericshearer@me.com){.email}
-   Issues/Bugs: <https://github.com/ericmshearer/OCepi/issues>
