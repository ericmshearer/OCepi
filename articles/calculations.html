<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>calculations • OCepi</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="calculations">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">OCepi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/calculations.html">calculations</a></li>
    <li><a class="dropdown-item" href="../articles/data-cleaning.html">data-cleaning</a></li>
    <li><a class="dropdown-item" href="../articles/date-conversions.html">date-conversions</a></li>
    <li><a class="dropdown-item" href="../articles/extending-ggplot2.html">extending-ggplot2</a></li>
    <li><a class="dropdown-item" href="../articles/linking_data.html">linking-data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ericmshearer/OCepi" aria-label="GitHub"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>calculations</h1>
            
      

      <div class="d-none name"><code>calculations.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="add_percent">add_percent()<a class="anchor" aria-label="anchor" href="#add_percent"></a>
</h2>
<p>One of the most used calculations is proportion. If you do not want
to multiply proportion by 100, add argument
<code>multiply = FALSE</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>race_ethnicity <span class="op">=</span> <span class="fu"><a href="../reference/recode_race.html">recode_race</a></span><span class="op">(</span><span class="va">Ethnicity</span>, <span class="va">Race</span>, abbr_names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">race_ethnicity</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>percent <span class="op">=</span> <span class="fu"><a href="../reference/add_percent.html">add_percent</a></span><span class="op">(</span><span class="va">n</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 × 3</span></span></span>
<span><span class="co">#&gt;   race_ethnicity             n percent</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> AI/AN                     10     9.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Asian                      7     6.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Black/African American    16    15.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Hispanic/Latinx           19    18.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Missing/Unknown            8     7.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Multiple Races             6     5.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> NHOPI                     10     9.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> Other                     15    14.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">9</span> White                     14    13.3</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="n_percent">n_percent()<a class="anchor" aria-label="anchor" href="#n_percent"></a>
</h2>
<p>When preparing data for {ggplot2}, you may want to create labels with
n and percent. Use argument <code>n_suppress</code> to suppress low
values and <code>reverse</code> to set order of n and % (default is n
then %).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>race_ethnicity <span class="op">=</span> <span class="fu"><a href="../reference/recode_race.html">recode_race</a></span><span class="op">(</span><span class="va">Ethnicity</span>, <span class="va">Race</span>, abbr_names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">race_ethnicity</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    percent <span class="op">=</span> <span class="fu"><a href="../reference/add_percent.html">add_percent</a></span><span class="op">(</span><span class="va">n</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    label <span class="op">=</span> <span class="fu"><a href="../reference/n_percent.html">n_percent</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">percent</span>, reverse <span class="op">=</span> <span class="cn">TRUE</span>, n_suppress <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 × 4</span></span></span>
<span><span class="co">#&gt;   race_ethnicity             n percent label     </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> AI/AN                     10     9.5 9.5% (10) </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Asian                      7     6.7 **        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Black/African American    16    15.2 15.2% (16)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Hispanic/Latinx           19    18.1 18.1% (19)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Missing/Unknown            8     7.6 **        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Multiple Races             6     5.7 **        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> NHOPI                     10     9.5 9.5% (10) </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> Other                     15    14.3 14.3% (15)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">9</span> White                     14    13.3 13.3% (14)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="dashboard_tbl">dashboard_tbl()<a class="anchor" aria-label="anchor" href="#dashboard_tbl"></a>
</h2>
<p>Pre-aggregating data for dashboarding can be a tedious and
disorganized task. One way to aggregate and organize your data is to
summarize all your data into one table. To use
<code>dashboard_tbl</code>, start with your data, then select which
columns you want to summarize, then call the function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    race_ethnicity <span class="op">=</span> <span class="fu"><a href="../reference/recode_race.html">recode_race</a></span><span class="op">(</span><span class="va">Ethnicity</span>, <span class="va">Race</span><span class="op">)</span>,</span>
<span>    agegroups <span class="op">=</span> <span class="fu"><a href="../reference/age_groups.html">age_groups</a></span><span class="op">(</span><span class="va">Age</span><span class="op">)</span>,</span>
<span>    Gender <span class="op">=</span> <span class="fu"><a href="../reference/recode_gender.html">recode_gender</a></span><span class="op">(</span><span class="va">Gender</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">Gender</span>, <span class="va">agegroups</span>, <span class="va">race_ethnicity</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dashboard_tbl.html">dashboard_tbl</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;          Variable                               Category  n Percent      Label</span></span>
<span><span class="co">#&gt; 1          Gender                                 Female 51    48.6 48.6% (51)</span></span>
<span><span class="co">#&gt; 2          Gender                                   Male 39    37.1 37.1% (39)</span></span>
<span><span class="co">#&gt; 3          Gender                        Missing/Unknown 15    14.3 14.3% (15)</span></span>
<span><span class="co">#&gt; 4       agegroups                                    0-9 12    11.4 11.4% (12)</span></span>
<span><span class="co">#&gt; 5       agegroups                                  10-19 11    10.5 10.5% (11)</span></span>
<span><span class="co">#&gt; 6       agegroups                                  20-29 11    10.5 10.5% (11)</span></span>
<span><span class="co">#&gt; 7       agegroups                                  30-39 13    12.4 12.4% (13)</span></span>
<span><span class="co">#&gt; 8       agegroups                                  40-49 12    11.4 11.4% (12)</span></span>
<span><span class="co">#&gt; 9       agegroups                                  50-59 12    11.4 11.4% (12)</span></span>
<span><span class="co">#&gt; 10      agegroups                                  60-69  6     5.7   5.7% (6)</span></span>
<span><span class="co">#&gt; 11      agegroups                                  70-79 17    16.2 16.2% (17)</span></span>
<span><span class="co">#&gt; 12      agegroups                                    80+ 11    10.5 10.5% (11)</span></span>
<span><span class="co">#&gt; 13      agegroups                        Missing/Unknown  0     0.0     0% (0)</span></span>
<span><span class="co">#&gt; 14 race_ethnicity          American Indian/Alaska Native 10     9.5  9.5% (10)</span></span>
<span><span class="co">#&gt; 15 race_ethnicity                                  Asian  7     6.7   6.7% (7)</span></span>
<span><span class="co">#&gt; 16 race_ethnicity                 Black/African American 16    15.2 15.2% (16)</span></span>
<span><span class="co">#&gt; 17 race_ethnicity                        Hispanic/Latinx 19    18.1 18.1% (19)</span></span>
<span><span class="co">#&gt; 18 race_ethnicity                        Missing/Unknown  8     7.6   7.6% (8)</span></span>
<span><span class="co">#&gt; 19 race_ethnicity                         Multiple Races  6     5.7   5.7% (6)</span></span>
<span><span class="co">#&gt; 20 race_ethnicity Native Hawaiian/Other Pacific Islander 10     9.5  9.5% (10)</span></span>
<span><span class="co">#&gt; 21 race_ethnicity                                  Other 15    14.3 14.3% (15)</span></span>
<span><span class="co">#&gt; 22 race_ethnicity                                  White 14    13.3 13.3% (14)</span></span></code></pre></div>
<p>It is important to remember you only pass the columns you want
summarized into the function, otherwise it will attempt to summarize all
columns. If you’re wanting to summarize by group or year, use
<code>group_by</code> and include that column in the group of columns
you pass into the function. To adjust digits on percent via
<code>digits</code> argument, and change n % order using
<code>reverse</code>.</p>
</div>
<div class="section level2">
<h2 id="rate_per_100k">rate_per_100k()<a class="anchor" aria-label="anchor" href="#rate_per_100k"></a>
</h2>
<p>Another common calculation for our team are is incidence rate per
100,000.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>race_ethnicity <span class="op">=</span> <span class="fu"><a href="../reference/recode_race.html">recode_race</a></span><span class="op">(</span><span class="va">Ethnicity</span>, <span class="va">Race</span>, abbr_names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">race_ethnicity</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"White"</span>,<span class="st">"NHOPI"</span>,<span class="st">"Multiple Races"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">race_ethnicity</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>incidence_rate <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>    <span class="va">race_ethnicity</span> <span class="op">==</span> <span class="st">"White"</span> <span class="op">~</span> <span class="fu"><a href="../reference/rate_per_100k.html">rate_per_100k</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1500000</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    <span class="va">race_ethnicity</span> <span class="op">==</span> <span class="st">"NHOPI"</span> <span class="op">~</span> <span class="fu"><a href="../reference/rate_per_100k.html">rate_per_100k</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">100000</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    <span class="va">race_ethnicity</span> <span class="op">==</span> <span class="st">"Multiple Races"</span> <span class="op">~</span> <span class="fu"><a href="../reference/rate_per_100k.html">rate_per_100k</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">200000</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">#&gt;   race_ethnicity     n incidence_rate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Multiple Races     6            3  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> NHOPI             10           10  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> White             14            0.9</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="time_between">time_between()<a class="anchor" aria-label="anchor" href="#time_between"></a>
</h2>
<p><code><a href="../reference/time_between.html">time_between()</a></code> calculates the time elapsed between two
dates in the following units: days, weeks, months and years. Value is
always rounded down to account for complete elapsed time. Note: order of
dates does not necessarily matter, but beware of sign.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">episode_date</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-04-01"</span><span class="op">)</span></span>
<span><span class="va">death_date</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-05-15"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/time_between.html">time_between</a></span><span class="op">(</span><span class="va">death_date</span>, <span class="va">episode_date</span>, unit <span class="op">=</span> <span class="st">"days"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 44</span></span>
<span><span class="fu"><a href="../reference/time_between.html">time_between</a></span><span class="op">(</span><span class="va">episode_date</span>, <span class="va">death_date</span>, unit <span class="op">=</span> <span class="st">"days"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -44</span></span>
<span></span>
<span><span class="va">dob</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"1986-04-01"</span><span class="op">)</span></span>
<span><span class="va">vaccine_date</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2023-05-15"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/time_between.html">time_between</a></span><span class="op">(</span><span class="va">vaccine_date</span>, <span class="va">dob</span>, unit <span class="op">=</span> <span class="st">"years"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 37</span></span>
<span><span class="fu"><a href="../reference/time_between.html">time_between</a></span><span class="op">(</span><span class="va">dob</span>, <span class="va">vaccine_date</span>, unit <span class="op">=</span> <span class="st">"years"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -37</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Eric Shearer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
